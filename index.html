---
layout: page
width: expand
---

<div class="container">
    <div class="row">
        <div class="col-2"></div>
        <div class="col">
            <input type="text" class="form-control" id="github_token" style="display: none;">
            <input type="text" class="form-control" id="openai_token" style="display: none;">
            <input type="text" class="form-control" id="bing_token" style="display: none;">
            <input type="text" class="form-control" id="aws_token" style="display: none;">
            <script>
                var github_token = getUrlVar('github_token');
                if (github_token) {
                    document.getElementById('github_token').value = github_token;
                }						              
                var openai_token = getUrlVar('openai_token');
                if (openai_token) {
                    document.getElementById('openai_token').value = openai_token;
                }		
                var bing_token = getUrlVar('bing_token');
                if (bing_token) {
                    document.getElementById('bing_token').value = bing_token;
                }	
                var aws_token = getUrlVar('aws_token');
                if (aws_token) {
                    document.getElementById('aws_token').value = aws_token;
                }	                                				              
            </script>
            <h2>APIs.io Network Admin</h2>
            <textarea style="display: none;" id="network" style="width: 100%; height: 100px;"></textarea>
            <textarea style="display: none;" id="vocabulary" style="width: 100%; height: 100px;"></textarea>
            <textarea style="display: none;" id="rules" style="width: 100%; height: 100px;">{{ site.rules | jsonify }}</textarea>
            <textarea style="display: none;" id="apis_json" style="width: 100%; height: 100px;"></textarea>
            <textarea style="display: none;" id="apis_json_overlay" style="width: 100%; height: 100px;"></textarea>
            <textarea style="display: none;" id="openapi" style="width: 100%; height: 100px;"></textarea>
            <textarea style="display: none;" id="openapi2" style="width: 100%; height: 100px;"></textarea>
            <table width="100%">
                <tr>
                    <td align="center">
                        <select class="form-control" id="node" onchange="manageNode();">
                            <option>Select Node</option>
                        </select>
                    </td>
                    <td align="center" id="include-select" style="display: none;">
                        <select class="form-control" id="include" onchange="manageInclude();">
                            <option>Select Include</option>
                        </select>
                    </td>
                    <!--
                    <td align="center" id="include-start" style="display: none;" width="10%">
                        <input type="text" id="include-start-count" class="form-control" value="0" style="text-align: center; width: 100%;">
                    </td>  
                    <td align="center" id="include-end" style="display: none;"" width="10%">
                        <input type="text" id="include-end-count" class="form-control" value="10" style="text-align: center; width: 100%;">
                    </td>  
                    
                    <td align="center" id="include-button" style="display: none;"" width="7%">
                        <button onclick="manageInclude(); return false;" type="button" class="btn btn-dark">Load</button>
                    </td>                                                          
                    --->
                </tr>
            </table>
            <div id="details"></div>
            <table width="100%">
                <tr>
                    <td align="center" id="apis_json_node_overlay_toolbar">
                        <button onclick="manageNodeOverlay(); return false;" type="button" class="btn btn-dark">Apply APIs.json Overlay</button>
                    </td>        
                    <td align="center" id="apis_json_toolbar">
                        <button onclick="saveAPIsJSON(); return false;" type="button" class="btn btn-dark">Save APIs.json</button>
                    </td>
                    <td align="center" id="apis_json_node_overlay_toolbar">
                        <button onclick="rateAPIsJSON(); return false;" type="button" class="btn btn-dark">Rate APIs.json Overlay</button>
                    </td>                                                     
                    <td align="center" id="apis_json_overlay_toolbar">
                        <button onclick="saveAPIsJSONOverlay(); return false;" type="button" class="btn btn-dark">Save APIs.json Overlay</button>
                    </td>
                </tr>
                <tr>
                    <td align="center" id="apis_json_node_overlay_toolbar">
                        <button onclick="processAPIsEngine(); return false;" type="button" class="btn btn-dark" id="engine-process-button">Engine Process</button>
                    </td>        
                    <td align="center" id="apis_json_toolbar">
                        <button onclick="generateAID(); return false;" type="button" class="btn btn-dark" id="generate-aid-button">Generate AID</button>
                    </td>
                    <td align="center" id="apis_json_node_overlay_toolbar">
                        <button onclick="rateAllAPIs(); return false;" type="button" class="btn btn-dark">Rate All APIs</button>
                    </td>                                                   
                    <td align="center" id="apis_json_overlay_toolbar"></td>
                </tr>                
            </table>              
            <table width="100%">
                <tr>
                    <td align="center" id="apis_json_node_overlay_toolbar">
                        <button onclick="cleanAPINames(); return false;" type="button" class="btn btn-dark">Clean APIs Names</button>
                    </td>       
                    <td align="center" id="apis_json_node_overlay_toolbar">
                        <button onclick="pullProperties(); return false;" type="button" class="btn btn-dark">Pull Properties</button>
                    </td>                                        
                </tr>
            </table>                        
            <div id="manage"></div>
            <script>

                function getDateWeek(date) {
                    const currentDate = 
                        (typeof date === 'object') ? date : new Date();
                    const januaryFirst = 
                        new Date(currentDate.getFullYear(), 0, 1);
                    const daysToNextMonday = 
                        (januaryFirst.getDay() === 1) ? 0 : 
                        (7 - januaryFirst.getDay()) % 7;
                    const nextMonday = 
                        new Date(currentDate.getFullYear(), 0, 
                        januaryFirst.getDate() + daysToNextMonday);
                
                    return (currentDate < nextMonday) ? 52 : 
                    (currentDate > nextMonday ? Math.ceil(
                    (currentDate - nextMonday) / (24 * 3600 * 1000) / 7) : 1);
                }                

                function slugify(str) {
                    return String(str)
                        .normalize('NFKD') // split accented characters into their base characters and diacritical marks
                        .replace(/[\u0300-\u036f]/g, '') // remove all the accents, which happen to be all in the \u03xx UNICODE block.
                        .trim() // trim leading or trailing whitespace
                        .toLowerCase() // convert to lowercase
                        .replace(/[^a-z0-9 -]/g, '-') // remove non-alphanumeric characters
                        .replace(/\s+/g, '-') // replace spaces with hyphens
                        .replace(/-+/g, '-'); // remove consecutive hyphens
                    }   

                // APIs.json Network
                ////document.getElementById("alert").innerHTML = "Pulling Search Nodes..."

                var options = {
                    method: 'GET'
                };

                fetch('https://apis.io/apis.json', options)
                    .then(function (response) {
                        if (!response.ok) {
                             //console.log('Error with Status Code: ' + response.status);
                        }
                        response.json().then(function (data) {

                            //var index = JSON.parse(data);
                            //console.log(data);
                            //document.getElementById("pull-apisjson-message").innerHTML = data.message;

                            for (let i = 0; i < data.network.length; i++) {
                                var node_name = data.network[i].name;
                                var node_url = data.network[i].url;
                                var node_slug = node_url.replace(".apis.io/apis.json", "");
                                node_slug = node_slug.replace("https://", "");
                                //console.log(node_slug);
                                var opt = document.createElement('option');
                                opt.value = node_url;
                                opt.innerHTML = node_name;
                                document.getElementById("node").appendChild(opt);
                            }

                        });
                    })
                    .catch(function (err) {
                        if (err == 'TypeError: Failed to fetch') {
                            ////document.getElementById("alert").innerHTML = err;
                        }
                    });

                //document.getElementById("alert").innerHTML = "";

                // Pulling Vocabulary
                //document.getElementById("alert").innerHTML = "Pulling Vocabulary"

                var options = {
                    method: 'GET'
                };

                fetch('https://raw.githubusercontent.com/api-search/admin/main/vocabulary.yml', options)
                    .then(function (response) {
                        if (!response.ok) {
                             //console.log('Error with Status Code: ' + response.status);
                        }
                        response.text().then(function (yaml) {

                            var vocabulary = jsyaml.load(yaml);
                            document.getElementById("vocabulary").value = JSON.stringify(vocabulary);

                        });
                    })
                    .catch(function (err) {
                        if (err == 'TypeError: Failed to fetch') {
                            //document.getElementById("alert").innerHTML = err;
                        }
                    });

                //document.getElementById("alert").innerHTML = "";

                function cleanAPINames(){

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);

                    for (let i = 0; i < apis_json_overlay.apis.length; i++) {

                        var api_name = apis_json_overlay.apis[i].name;
                        var api_json_name = apis_json_overlay.name;

                        var working = api_name.replaceAll("{","");
                        
                        working = working.replaceAll("}","");
                        working = working.replaceAll("/"," ");
                        working = working.replaceAll("-"," ");
                        working = working.replaceAll("_"," ");                        
                        working = splitPascalCase(working);
                        working = working.toLowerCase();  
                        working = working.replaceAll(" user user "," user ");

                        working = working.replaceAll("userid","");
                        working = working.replaceAll("itemid","");

                        working = working.replaceAll(" id"," ");
                        working = working.replaceAll(" api"," API");
                        working = working.replaceAll("user id",""); 
                        working = working.replaceAll("  "," ");                                               
                        
                        // BUNQ _ ONLY
                        working = working.replaceAll("User ",""); 


                        working = capitalizeFirstLetter(working);
                        working = working.trim();

                        if(!working.includes(api_json_name)){
                            working = api_json_name + ' ' + working;
                        }

                        if(!working.includes('API')){
                            working = working + ' API';
                        }               
                        
                        working = working.replaceAll("Api API","API");
                        
                        //console.log("working: " + working);

                        apis_json_overlay.apis[i].name = working;
                        if(document.getElementById('name-' + i)){
                        document.getElementById('name-' + i).value = working;
                        }
                                 
                    }

                    document.getElementById("apis_json_overlay").value  = JSON.stringify(apis_json_overlay);                  

                }

            function pullProperties(){
                var apis_json_url = document.getElementById("include").value;
                var apis_json = JSON.parse(document.getElementById("apis_json").value);
                var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);                
                for (let i = 0; i < apis_json.apis.length; i++) {
                    apis_json_overlay.apis[i].properties = apis_json.apis[i].properties;
                }

                document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);            

                displayInclude(apis_json_overlay,apis_json_url);
                manageNodeOverlay();
            }

            function rateAPIsJSON() {

                var github_token = document.getElementById("github_token").value;
                var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                var apis_json_url = document.getElementById("include").value;
                //console.log(apis_json_url);

                var all_rules = JSON.parse(document.getElementById("rules").value);
                var aws_token = document.getElementById("aws_token").value;

                var segments = apis_json_url.split("/");
                var node = segments[4];
                var provider = segments[7];                       

                var linting_api_url = 'https://linter-api.apis.io/linter/apisjson';

                const options = {
                    method: 'POST',
                    headers: {
                        "Accept": "application/json",
                        "X-API-KEY": aws_token                 
                    },
                    body: JSON.stringify(apis_json_overlay)
                };  

                fetch(linting_api_url,options)
                    .then(function(response) {
                        if (!response.ok) {
                             //console.log('Error with Status Code: ' + response.status);
                            return;
                        }
                        response.json().then(function(data) {   

                            var api_score = 0;
                            //console.log(data);
                            var rating = {};
                            rating.weekNumber = getDateWeek();
                            rating.rule = [];

                            for (let m = 0; m < data.length; m++) {
                                var rule = {};
                                rule.code = data[m].code;
                                rule.message = data[m].message;
                                rating.rule.push(rule);

                                for (let r = 0; r < all_rules.length; r++) {
                                    if(all_rules[r].slug == data[m].code){
                                        //console.log(data[m].code + " == " + all_rules[r].score);
                                        api_score = api_score + all_rules[r].score;
                                    }
                                }
                            }

                            console.log("overall score: " + api_score);
                            apis_json_overlay.score = api_score;
                            document.getElementById("score").value = api_score;
                            
                            console.log(rating);
     
                            if(apis_json_overlay.overlays){

                            }
                            else{
                                apis_json_overlay.overlays = [];
                            }
        
                            var already = 0;
                            for (let m = 0; m < apis_json_overlay.overlays.length; m++) {
                                if(apis_json_overlay.overlays[m].type == 'API Evangelist Ratings'){
                                    already = 1; 
                                    apis_json_overlay.overlays[m].url = "overlays/apis-io-search.yml";
                                }
                            }
                            if(already == 0){
                                var overlay = {};
                                overlay.type = "API Evangelist Ratings";
                                overlay.url = "/overlays/api-evangelist-ratings.yml";
                                apis_json_overlay.overlays.push(overlay);                                
                            }

                            document.getElementById("score").value = api_score;
                            document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                            
                            var github_url = 'https://api.github.com/repos/api-search/' + node + '/contents/_data/' + provider + "/overlays/api-evangelist-ratings.yml";
                            //console.log("github_url: " + github_url);                    

                            const options = {
                                method: 'get',
                                headers: {
                                    "Accept": "application/vnd.github+json",
                                    "Authorization": 'Bearer ' + github_token
                                }
                            };  

                            fetch(github_url,options)
                                .then(function(response) {
                                    if (!response.ok) {
                                        
                                        //console.log('Error with Status Code: ' + response.status);

                                        var c = {};
                                        c.name = "Kin Lane";
                                        c.email = "kinlane@gmail.com";

                                        var m = {};
                                        m.message = 'Creating API Evangelist Rating Overlay';
                                        m.committer = c;
                                        var save_overlay = jsyaml.dump(rating);
                                        m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                        const options = {
                                            method: 'PUT',
                                            headers: {
                                                "Accept": "application/vnd.github+json",
                                                "Authorization": 'Bearer ' + github_token                                 
                                            },
                                            body: JSON.stringify(m)
                                        };  

                                        fetch(github_url,options)
                                            .then(function(response) {
                                                if (!response.ok) {
                                                     //console.log('Error with Status Code: ' + response.status);
                                                    return;
                                                }
                                                response.json().then(function(data) {   
                                                    //console.log(data);                                                                           
                                                });
                                            })
                                            .catch(function(err) {
                                                 //console.log('Error: ' + err);
                                        }); 

                                        return;
                                    }
                                    response.json().then(function(data) {   

                                        var sha = data.sha;
                                    
                                        var c = {};
                                        c.name = "Kin Lane";
                                        c.email = "kinlane@gmail.com";

                                        var m = {};
                                        m.message = 'Saving API Evangelist Rating Overlay';
                                        m.committer = c;
                                        m.sha = sha;
                                        var save_overlay = jsyaml.dump(rating);
                                        m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                        const options = {
                                            method: 'PUT',
                                            headers: {
                                                "Accept": "application/vnd.github+json",
                                                "Authorization": 'Bearer ' + github_token                                 
                                            },
                                            body: JSON.stringify(m)
                                        };  

                                        fetch(github_url,options)
                                            .then(function(response) {
                                                if (!response.ok) {
                                                     //console.log('Error with Status Code: ' + response.status);
                                                    return;
                                                }
                                                response.json().then(function(data) {   
                                                    //console.log(data);                                                                           
                                                });
                                            })
                                            .catch(function(err) {
                                                 //console.log('Error: ' + err);
                                        }); 

                                    });
                                })
                                .catch(function(err) {
                                     //console.log('Error: ' + err);
                            });                                

                        });
                    })
                    .catch(function(err) {
                         //console.log('Error: ' + err);
                });

                }              
                
                function sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                    }           

                function rateAllAPIs(){

                    var apis_json_url = document.getElementById("node").value;
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);

                    for (let i = 0; i < apis_json_overlay.apis.length; i++) {
                        if(apis_json_overlay.apis[i].properties){
                            for (let j = 0; j < apis_json_overlay.apis[i].properties.length; j++) {
                                loadOpenAPIProperty(i,j,apis_json_overlay.apis[i].properties[j].url,apis_json_url);
                                sleep(10000).then(() => { 
                                    console.log('World!'); 
                                    rateOpenAPI(i,j,apis_json_overlay.apis[i].properties[j].url,apis_json_url);
                                    resetOpenAPI(i,j,apis_json_overlay.apis[i].properties[j].url,apis_json_url);                                     
                                });                                    
                            }
                        }                        
                        
                    }                    

                }

                function splitPascalCase(word) {
                    const camelCase = word.replace(/([a-z])([A-Z])/g, '$1 $2').split(" ");

                    let flat = "";

                    camelCase.forEach(word=>{    
                        flat = flat + word.charAt(0).toUpperCase() + word.slice(1) + " "
                    });
                    return flat; 
                }

                function capitalizeFirstLetter(str) {
                    return str.replace(/\w\S*/g, function(txt){
                        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                    });
                }                

                function manageNode() {

                    //document.getElementById("alert").innerHTML = "Parsing Node..."

                    document.getElementById("manage").innerHTML = '';
                    document.getElementById("apis_json").value = '{}';             

                    var apis_json_url = document.getElementById("node").value;

                    var i, L = document.getElementById("include").options.length - 1;
                    for(i = L; i >= 0; i--) {
                        document.getElementById("include").remove(i);
                    }

                    var opt = document.createElement('option');
                    opt.value = "";
                    opt.innerHTML = "Select Include";
                    document.getElementById("include").appendChild(opt);                    

                    //console.log("pulling11: " + apis_json_url);

                    const options = {
                        method: 'GET'
                    };

                    fetch(apis_json_url, options)
                        .then(function (response) {

                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.text().then(function (yaml) {
                                
                                //console.log(yaml);

                                var apis_json = jsyaml.load(yaml);

                                document.getElementById("network").value = JSON.stringify(apis_json);

                                //console.log(apis_json);  
                                for (let i = 0; i < apis_json.includes.length; i++) {
                                    var include_name = apis_json.includes[i].name;
                                    var include_url = apis_json.includes[i].url;
                                    var opt = document.createElement('option');
                                    opt.value = include_url;
                                    opt.innerHTML = include_name;
                                    document.getElementById("include").appendChild(opt);
                                }

                                document.getElementById("include-select").style.display = '';
                                //document.getElementById("include-start").style.display = '';
                                //document.getElementById("include-end").style.display = '';
                                //document.getElementById("include-button").style.display = '';

                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });

                    //document.getElementById("alert").innerHTML = "";
                }

                function parseTagsFromPath(i,j,path,verb){

                    var openapi = JSON.parse(document.getElementById("openapi").value);

                    var summary = document.getElementById("summary-" + i + '-' + j + '-' + path + '-' + verb).value;
                    var tags = document.getElementById("tags-" + i + '-' + j + '-' + path + '-' + verb).value;
                    tags = tags.replace("none");

                    tags = splitPascalCase(tags);
                    summary = splitPascalCase(summary);
                    
                    //console.log("path: " + path);

                    var working = path.replaceAll("{","");
                    working = working.replaceAll("}","");
                    working = working.replaceAll("/"," ");
                    working = working.replaceAll("-"," ");
                    working = working.replaceAll("_"," ");
                    working = working.replaceAll("id"," ");
                    working = splitPascalCase(working);
                    working = working.trim();
                    working = capitalizeFirstLetter(working);
                    working = working.replaceAll(" ",", ");
                    //console.log("working: " + working);
                    var path_array = working.split(", ");
                    var summary_array = summary.split(" ");

                    if(verb.toLowerCase() == 'get' || verb.toLowerCase() == 'post' || verb.toLowerCase() == 'put' || verb.toLowerCase() == 'patch' || verb.toLowerCase() == 'delete'){

                        openapi.paths[path][verb].tags = [];

                        //console.log(path);
                        //console.log(verb);
                        //console.log(openapi.paths[path][verb].tags);                    

                        for (let i = 0; i < path_array.length; i++) {
                            var this_tag = path_array[i];
                            this_tag = this_tag.replace(/[._-]/g, ' ');
                            //console.log("this_tag: " + this_tag);
                            if(this_tag.length>1){
                                this_tag = this_tag.trim();
                                openapi.paths[path][verb].tags.push(this_tag);
                            }
                        }
                        for (let i = 0; i < summary_array.length; i++) {
                            var this_tag = summary_array[i];
                            this_tag = this_tag.replace(/[._-]/g, ' ');
                            //console.log("this_tag: " + this_tag);
                            if(this_tag.length>1){
                                this_tag = this_tag.trim();
                                openapi.paths[path][verb].tags.push(this_tag);
                            }
                        }                    
                        document.getElementById("tags-" + i + '-' + j + '-' + path + '-' + verb).value = openapi.paths[path][verb].tags;
                        document.getElementById("openapi").value = JSON.stringify(openapi);
                    }
                }

                function parseCamelCaseSummary(i,j,path,verb){

                    var openapi = JSON.parse(document.getElementById("openapi").value);

                    var summary = openapi.paths[path][verb].summary;

                    //console.log("summary: " + summary);

                    summary = splitPascalCase(summary);

                    //console.log("summary: " + summary);

                    openapi.paths[path][verb].summary = summary;
                    document.getElementById("summary-" + i + '-' + j + '-' + path + '-' + verb).value = summary;
                    document.getElementById("openapi").value = JSON.stringify(openapi);

                }

                function generateSummary(i,j,path,verb){

                    var openapi = JSON.parse(document.getElementById("openapi").value);

                    var path_base = path;

                    //console.log("path: " + path_base);
                    //console.log("verb: " + verb);

                    var working = path_base.replaceAll("{","");
                    working = working.replaceAll("}","");
                    working = working.replaceAll("/"," ");
                    working = working.replaceAll("-"," ");
                    working = working.replaceAll("_"," ");
                    //working = working.replaceAll("id"," ");
                    working = working.replaceAll("V1","");
                    working = working.replaceAll("v1","");
                    working = working.replaceAll("V2","");
                    working = working.replaceAll("v2","");                    
                    working = working.replaceAll("V3","");
                    working = working.replaceAll("v3","");                    
                    working = working.replaceAll(" S "," ");
      
                    working = splitPascalCase(working);
                    working = working.trim();
                    working = capitalizeFirstLetter(working);
                    
                    //console.log("working: " + working);   
                    
                    var action = "Retrieve ";
                    if(verb.toLowerCase() == 'post'){
                        action = "Create ";
                    }
                    if(verb.toLowerCase() == 'put'){
                        action = "Update ";
                    }
                    if(verb.toLowerCase() == 'delete'){
                        action = "Delete ";
                    }                                        
                    var summary = action + working;

                    openapi.paths[path][verb].summary = summary;
                    document.getElementById("summary-" + i + '-' + j + '-' + path + '-' + verb).value = summary;
                    document.getElementById("openapi").value = JSON.stringify(openapi);

                    }                

                function saveOpenAPISummary(i,j,path,verb){
                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    openapi.paths[path][verb].summary = document.getElementById("summary-" + i + '-' + j + '-' + path + '-' + verb).value
                    document.getElementById("openapi").value = JSON.stringify(openapi);
                    }  
                    
                function saveOpenAPIDescription(i,j,path,verb){
                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    openapi.paths[path][verb].description = document.getElementById("description-" + i + '-' + j + '-' + path + '-' + verb).value
                    document.getElementById("openapi").value = JSON.stringify(openapi);
                    }   
                    
                function saveOpenAPITags(i,j,path,verb){
                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    openapi.paths[path][verb].tags = document.getElementById("tags-" + i + '-' + j + '-' + path + '-' + verb).value.split(",");
                    document.getElementById("openapi").value = JSON.stringify(openapi);
                    }                       

                function rollbackOpenAPIDescription(i,j,path,verb) {

                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    //document.getElementById("alert").innerHTML = "Writing description"

                    document.getElementById("description-" + i + '-' + j + '-' + path + '-' + verb).value = document.getElementById("description2-" + i + '-' + j + '-' + path + '-' + verb).value;
                    openapi.paths[path][verb].description = document.getElementById("description2-" + i + '-' + j + '-' + path + '-' + verb).value;
                    document.getElementById("openapi").value = JSON.stringify(openapi);                     
                    //document.getElementById("alert").innerHTML = "";
                    }  
                    
                function writeOpenAPIDescription(i,j,path,verb) {

                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    //document.getElementById("alert").innerHTML = "Writing description"

                    var openai_token = document.getElementById("openai_token").value;

                    var description = openapi.paths[path][verb].description;
                    description = description.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");

                    var open_ai_url = "https://api.openai.com/v1/chat/completions";

                    var chat = {};
                    chat.model = "gpt-3.5-turbo";
                    chat.messages = [];

                    var message = {};
                    message.role = "user";
                    message.content = "Can you rewrite this description of my API? " + description;
                    chat.messages.push(message);

                    chat = JSON.stringify(chat);
                    //console.log(chat);

                    const options = {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": 'Bearer ' + openai_token
                        },
                        body: chat
                    };

                    //console.log(options);

                    fetch(open_ai_url, options)
                        .then(function (response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.json().then(function (data) {
                                //console.log(data.choices[0].message.content);
                                document.getElementById("description2-" + i + '-' + j + '-' + path + '-' + verb).value = document.getElementById("description-" + i + '-' + j + '-' + path + '-' + verb).value;
                                document.getElementById("description-" + i + '-' + j + '-' + path + '-' + verb).value = data.choices[0].message.content;                                    
                                openapi.paths[path][verb].description = data.choices[0].message.content;
                                document.getElementById("openapi").value = JSON.stringify(openapi);
                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });

                    //document.getElementById("alert").innerHTML = "";
                    }                    

                    function dedupeAPIsJSONAPITags(i){

                        var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);

                        var tags = apis_json_overlay.apis[i].tags;

                        //console.log("tags: " + tags);

                        var tags_new = [];

                        if(apis_json_overlay.apis[i].tags){
                            for (let m = 0; m < tags.length; m++) {
                                var already = 0;
                                for (let n = 0; n < tags_new.length; n++) {
                                    if(tags[m].trim() == tags_new[n].trim()){
                                        already = 1;
                                    }
                                }
                                if(already==0){
                                    this_tag = tags[m].trim();
                                    tags_new.push(this_tag);
                                }
                            }
                        }

                        apis_json_overlay.apis[i].tags = tags_new.sort();
                        document.getElementById("tags-" + i).value = tags_new;
                        document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);

                        }                           

                function dedupeOpenAPIOperationTags(i,j,path,verb){

                    var openapi = JSON.parse(document.getElementById("openapi").value);

                    var tags = openapi.paths[path][verb].tags;

                    var tags_new = [];
                    if(openapi.paths[path][verb].tags){
                        for (let m = 0; m < tags.length; m++) {
                            var already = 0;
                            for (let n = 0; n < tags_new.length; n++) {
                                if(tags[m].trim() == tags_new[n].trim()){
                                    already = 1;
                                }
                            }
                            if(already==0){
                                this_tag = tags[m].trim();
                                tags_new.push(this_tag);
                            }
                        }
                    }

                    openapi.paths[path][verb].tags = tags_new.sort();
                    document.getElementById("tags-" + i + '-' + j + '-' + path + '-' + verb).value = tags_new;
                    document.getElementById("openapi").value = JSON.stringify(openapi);

                }   
           
            function compareAPIsJSONAPITagsWithVocabulary(i){

                var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                var vocabulary = JSON.parse(document.getElementById("vocabulary").value);

                var tags = apis_json_overlay.apis[i].tags;

                var tag_new = [];

                if(apis_json_overlay.apis[i].tags){
                    for (let m = 0; m < tags.length; m++) {
                        var in_vocabulary = 0;
                        for (const [word, value] of Object.entries(vocabulary)) {                            
                            if(word == tags[m]){
                                in_vocabulary = 1;
                                if(value){                                    
                                    if(value == "~"){
                                        //console.log(tags[m] + " is removed");
                                    }                          
                                    else{
                                        if(value.length > 0){
                                            this_tag = value;
                                            this_tag = this_tag.trim();
                                            tag_new.push(this_tag);
                                        } 
                                    }
                                }
                                else{
                                    this_tag = tags[m];
                                    if(this_tag && this_tag.length > 0){
                                        this_tag = this_tag.trim();
                                        tag_new.push(this_tag);
                                        }
                                    }                                
                            }   
                        }
                        if(in_vocabulary == 0){
                            this_tag = tags[m];
                            if(this_tag && this_tag.length > 0){
                                this_tag = this_tag.trim();
                                tag_new.push(this_tag); 
                            }
                        }
                    }   
                }                 

                apis_json_overlay.apis[i].tags = tag_new;
                document.getElementById("tags-" + i).value = tag_new;
                document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);

                }                  

                function compareOpenAPIOperationTagsWithVocabulary(i,j,path,verb){

                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    var vocabulary = JSON.parse(document.getElementById("vocabulary").value);

                    var tags = openapi.paths[path][verb].tags;

                    //console.log("tags: " + tags);

                    var tag_new = [];
                    var this_tag = '';

                    if(openapi.paths[path][verb].tags){
                        for (let m = 0; m < tags.length; m++) {
                            var in_vocabulary = 0;
                            for (const [word, value] of Object.entries(vocabulary)) {
                                if(word == tags[m]){
                                    in_vocabulary = 1;
                                    if(value){                                    
                                        if(value == "~"){
                                            //console.log(tags[m] + " is removed");
                                        }                          
                                        else{
                                            if(value && value.length > 0){
                                                this_tag = value;
                                                this_tag = this_tag.trim();
                                                tag_new.push(this_tag); 
                                            } 
                                        }
                                    }
                                    else{
                                        this_tag = tags[m];
                                        if(this_tag && this_tag.length > 0){
                                            this_tag = this_tag.trim();
                                            tag_new.push(this_tag);  
                                            }
                                        }                                
                                }   
                            }
                            if(in_vocabulary == 0){
                                this_tag = tags[m];
                                if(this_tag && this_tag.length > 0){
                                    this_tag = this_tag.trim();
                                    tag_new.push(this_tag); 
                                }
                            }
                        }   
                    }                 

                    openapi.paths[path][verb].tags = tag_new;
                    document.getElementById("tags-" + i + '-' + j + '-' + path + '-' + verb).value = tag_new;
                    document.getElementById("openapi").value = JSON.stringify(openapi);

                    }                  
                
                function resetOpenAPI(i, j, openapi_path, apis_json_url) {                    
                    document.getElementById("paths-" + i + "-" + j).innerHTML = "";
                    document.getElementById("manage-" + i).innerHTML = "";
                    }

                function processOpenAPI(i, j, openapi_path, apis_json_url) {

                    //document.getElementById("alert").innerHTML = "Processing OpenAPI..."
                    var openapi = JSON.parse(document.getElementById("openapi").value);

                    //console.log(apis_json_overlay);
                    for (const [path, method] of Object.entries(openapi.paths)) {
                        for (const [verb, operation] of Object.entries(method)) {

                            if(verb.toLowerCase() == 'get' || verb.toLowerCase() == 'post' || verb.toLowerCase() == 'put' || verb.toLowerCase() == 'patch' || verb.toLowerCase() == 'delete'){
                            
                            if(!operation.summary){
                                generateSummary(i,j,path,verb);
                            }
                            else{
                                parseCamelCaseSummary(i,j,path,verb);
                            }

                            parseTagsFromPath(i,j,path,verb);
                            
                            compareOpenAPIOperationTagsWithVocabulary(i,j,path,verb);
                            dedupeOpenAPIOperationTags(i,j,path,verb);
                            compareOpenAPIOperationTagsWithVocabulary(i,j,path,verb);

                            }
                        }
                    }                                     
                }                    

                function writeOpenAPIOverlay(node,provider,base_overlay_file_name,openapi_template,github_token,openapi_template){

                    github_overlay_url = 'https://api.github.com/repos/api-search/' + node + '/contents/_data/' + provider + '/overlays/' + provider + '-' + base_overlay_file_name;
                    
                    //console.log("github_url: " + github_overlay_url);                    

                    var options = {
                        method: 'get',
                        headers: {
                            "Accept": "application/vnd.github+json",
                            "X-GitHub-Api-Version": "2022-11-28",
                            "Authorization": 'Bearer ' + github_token
                        }
                    };  

                    fetch(github_overlay_url,options)
                        .then(function(response) {
                            if (!response.ok) {
                                
                                //console.log('Creating: ' + response.status);

                                var c = {};
                                c.name = "Kin Lane";
                                c.email = "kinlane@gmail.com";

                                var m = {};
                                m.message = 'Saving OpenAPI Overlay';
                                m.committer = c;

                                var save_overlay = jsyaml.dump(openapi_template);
                                m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                var options = {
                                    method: 'PUT',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "X-GitHub-Api-Version": "2022-11-28",
                                        "Authorization": 'Bearer ' + github_token                                 
                                    },
                                    body: JSON.stringify(m)
                                };  

                                fetch(github_overlay_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                             //console.log('Error with Status Code: ' + response.status);
                                            return;
                                        }
                                        response.json().then(function(data) {   
                                            //console.log(data);                                                                           
                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                });

                                return;
                            }
                            response.json().then(function(data) {   

                                var sha = data.sha;
                            
                                var c = {};
                                c.name = "Kin Lane";
                                c.email = "kinlane@gmail.com";

                                var m = {};
                                m.message = 'Saving OpenAPI Overlay';
                                m.committer = c;
                                m.sha = sha;
                                var save_overlay = jsyaml.dump(openapi_template);
                                m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                var options = {
                                    method: 'PUT',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "Authorization": 'Bearer ' + github_token                                 
                                    },
                                    body: JSON.stringify(m)
                                };  

                                fetch(github_overlay_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                             //console.log('Error with Status Code: ' + response.status);
                                            return;
                                        }
                                        response.json().then(function(data) {   
                                            //console.log(data);                                                                           
                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                }); 
                            });
                        })
                        .catch(function(err) {
                             //console.log('Error: ' + err);
                    });                      
                }

                function writeOpenAPIProperty(node,provider,base_overlay_file_name,base_openapi_file_name,github_token,openapi_template){

                    var github_property_url = 'https://api.github.com/repos/api-search/' + node + '/contents/_data/' + provider + '/properties/' + provider + '-' + base_openapi_file_name;
                    
                    //console.log("github_url: " + github_property_url);                    

                    var options = {
                        method: 'get',
                        headers: {
                            "Accept": "application/vnd.github+json",
                            "X-GitHub-Api-Version": "2022-11-28",
                            "Authorization": 'Bearer ' + github_token
                        }
                    };  

                    fetch(github_property_url,options)
                        .then(function(response) {
                            if (!response.ok) {
                                
                                //console.log('Creating New Property: ' + response.status);

                                var c = {};
                                c.name = "Kin Lane";
                                c.email = "kinlane@gmail.com";

                                var m = {};
                                m.message = 'Creating New OpenAPI Propery';
                                m.committer = c;

                                var save_overlay = jsyaml.dump(openapi_template);
                                m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                var options = {
                                    method: 'PUT',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "X-GitHub-Api-Version": "2022-11-28",
                                        "Authorization": 'Bearer ' + github_token                                 
                                    },
                                    body: JSON.stringify(m)
                                };  

                                fetch(github_property_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                             //console.log('Error with Status Code: ' + response.status);
                                            return;
                                        }
                                        response.json().then(function(data) {   
                                            //console.log(data);                                                                           
                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                }); 

                                return;
                            }
                            response.json().then(function(data) {   

                                var sha = data.sha;
                            
                                var c = {};
                                c.name = "Kin Lane";
                                c.email = "kinlane@gmail.com";

                                var m = {};
                                m.message = 'Saving OpenAPI Property';
                                m.committer = c;
                                m.sha = sha;
                                var save_overlay = jsyaml.dump(openapi_template);
                                m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                var options = {
                                    method: 'PUT',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "X-GitHub-Api-Version": "2022-11-28",
                                        "Authorization": 'Bearer ' + github_token                                 
                                    },
                                    body: JSON.stringify(m)
                                };  

                                fetch(github_property_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                             //console.log('Error with Status Code: ' + response.status);
                                            return;
                                        }
                                        response.json().then(function(data) {   
                                            //console.log(data);                                                                           
                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                }); 
                            });
                        })
                        .catch(function(err) {
                             //console.log('Error: ' + err);
                    });                    
                }

                function explodeOpenAPIs(i,apis_json_url){

                    var github_token = document.getElementById("github_token").value;
                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    var apis_json = JSON.parse(document.getElementById("apis_json").value);
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    
                    //console.log(openapi);

                    var base_path = document.getElementById('select-path-' + i).value;
                    var base_path_override = document.getElementById('select-path-override-' + i).value;
                    if(base_path_override!=''){ base_path = base_path_override; }

                    var openapi_template = JSON.parse(document.getElementById("openapi").value);
                    openapi_template.paths = {};
                    openapi_template.tags = [];
                    openapi_template.components = {};
                    openapi_template.components.schemas = {};                

                    base_name = base_path.replace("/v1/","");
                    base_name = base_name.replace("/"," ");
                    base_name = base_name.replace("_"," ");

                    var segments = apis_json_url.split("/");
                    var node = segments[4];
                    var provider = segments[7];                    

                    var base_openapi_file_name = slugify(base_name) + "-openapi-original.yml";
                    var base_overlay_file_name = slugify(base_name) + "-openapi-search.yml";                    

                    //console.log(base_path);
                    //console.log(base_name);

                    openapi_template.info.title = base_name;
                    openapi_template.info.description = "Needs description.";

                    var api = {};
                    api.name = base_name;
                    api.description = "Needs description.";
                    api.tags = [];
                    api.properties = [];
                    api.overlays = [];

                    var p = {};
                    p.type = "OpenAPI";
                    p.url = "properties/" + provider + '-' + base_openapi_file_name;
                    api.properties.push(p);
                    
                    var o = {};
                    o.type = "OpenAPI";
                    o.url = "overlays/" + provider + '-' + base_overlay_file_name;
                    api.overlays.push(o);                    

                    apis_json_overlay.apis.push(api);
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);

                    apis_json.apis.push(api);
                    document.getElementById("apis_json").value = JSON.stringify(apis_json);

                    var path_counter = 1;
                    for (const [path, method] of Object.entries(openapi.paths)) {   
                        
                        //console.log(path + ' includes ' + base_path);

                        if(path.includes(base_path)){
                            
                            openapi_template.paths[path] = method;

                            for (const [verb, operation] of Object.entries(method)) {  
                                
                                if(verb!='servers' && verb!='description' && verb!='x-twilio'){

                                    if(operation.responses && operation.responses['200']){
                                        if(operation.responses['200'].content){
                                            if(operation.responses['200'].content['application/json']){
                                                if(operation.responses['200'].content['application/json'].schema){
                                                    if(operation.responses['200'].content['application/json'].schema['$ref']){
                                                        var ref = operation.responses['200'].content['application/json'].schema['$ref'];                                            
                                                        var schema = ref.replace("#/components/schemas/","");
                                                        //console.log("1: " + schema);
                                                        openapi_template.components.schemas[schema] = openapi.components.schemas[schema];
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if(operation.responses && operation.responses['default']){
                                        if(operation.responses['default'].content['application/json']){
                                            if(operation.responses['default'].content['application/json'].schema){
                                                if(operation.responses['default'].content['application/json'].schema['$ref']){
                                                    var ref = operation.responses['default'].content['application/json'].schema['$ref'];
                                                    var schema = ref.replace("#/components/schemas/","");
                                                    //console.log("2: " + schema);
                                                    openapi_template.components.schemas[schema] = openapi.components.schemas[schema];
                                                }                                
                                            }
                                        }
                                    }
                                }

                             }

                        path_counter++;
                        }
                    }

                    document.getElementById("openapi2").innerHTML = JSON.stringify(openapi_template);

                    // Write Property...
                    writeOpenAPIProperty(node,provider,base_openapi_file_name,base_openapi_file_name,github_token,openapi_template);

                    // Write Overlay...
                    //writeOpenAPIOverlay(node,provider,base_overlay_file_name,openapi_template,github_token,openapi_template);

                }     

            function createOpenAPIOverlay(i, j, openapi_path, apis_json_url) {

                //document.getElementById("alert").innerHTML = "Loading OpenAPI...";

                var openapi = JSON.parse(document.getElementById("openapi").value);
                var github_token = document.getElementById("github_token").value;

                //console.log("pulling1: " + openapi_path);
                //console.log("pulling2: " + apis_json_url);

                var apis_json_overlay_url = apis_json_url.replace("overlays/apis-io-search.yml", openapi_path);
                apis_json_overlay_url = apis_json_overlay_url.replace("https://raw.githubusercontent.com/","https://api.github.com/repos/");
                apis_json_overlay_url = apis_json_overlay_url.replace("/main/","/contents/");
                apis_json_overlay_url = apis_json_overlay_url.replace("properties/", "overlays/");
                apis_json_overlay_url = apis_json_overlay_url.replace("-openapi-original.yml", "-openapi-search.yml");

                //console.log("overlay: " + apis_json_overlay_url);

                const options = {
                    method: 'GET'
                };

                fetch(apis_json_overlay_url, options)
                    .then(function (response) {

                        if (!response.ok) {
                            
                            //console.log('Create OpenAPI Overlay 111: ' + response.status);
                    
                            var c = {};
                            c.name = "Kin Lane";
                            c.email = "kinlane@gmail.com";

                            var m = {};
                            m.message = 'Create OpenAPI Overlay';
                            m.committer = c;

                            var save_overlay = jsyaml.dump(openapi);
                            m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                            var options = {
                                method: 'PUT',
                                headers: {
                                    "Accept": "application/vnd.github+json",
                                    "X-GitHub-Api-Version": "2022-11-28",
                                    "Authorization": 'Bearer ' + github_token                                 
                                },
                                body: JSON.stringify(m)
                            };  

                            fetch(apis_json_overlay_url,options)
                                .then(function(response) {
                                    if (!response.ok) {
                                         //console.log('Error with Status Code: ' + response.status);
                                        return;
                                    }
                                    response.json().then(function(data) {   
                                        //console.log(data);                                                                           
                                    });
                                })
                                .catch(function(err) {
                                     //console.log('Error: ' + err);
                            });                             

                        }
                        response.text().then(function (yaml) {                        

                        });
                    })
                    .catch(function (err) {
                        if (err == 'TypeError: Failed to fetch') {
                            //document.getElementById("alert").innerHTML = err;
                        }
                    });

                }

            function loadOpenAPIProperty(i, j, openapi_path, apis_json_url) {

                //document.getElementById("alert").innerHTML = "Loading OpenAPI..."

                //console.log("pulling: " + openapi_path);
                //console.log("pulling: " + apis_json_url);

                var url = apis_json_url.replace("overlays/apis-io-search.yml", openapi_path);

                //console.log("overlay: " + url);

                const options = {
                    method: 'GET'
                };

                fetch(url, options)
                    .then(function (response) {

                        if (!response.ok) {
                             //console.log('Error with Status Code: ' + response.status);
                        }
                        response.text().then(function (yaml) {

                            //console.log(yaml);
                            yaml = yaml.replace("---","");
                            yaml = yaml.replace("---","");                                
                            var openapi = jsyaml.load(yaml);
                            //console.log(openapi);
                            document.getElementById("openapi").value = JSON.stringify(openapi);
                            //console.log(i);
                            //console.log(j);

                            if(openapi.paths){
                            
                                html = '';

                                html += '<table width="100%" style="background-color: #CCC;">';
                                html += '<tr>';
                                html += '<td align="right" width="20%"><strong>Paths:</strong></td>';
                                html += '<td width="45%">';
                                html += '<select id="select-path-' + i + '">';
                                    
                                var base_paths = [];
                                for (const [path, method] of Object.entries(openapi.paths)) {
                                    var path_array = path.split("/");
                                    //var base_path = path_array[0] + '/' + path_array[1];
                                    var base_path = path_array[0] + '/';
                                    if(path_array[1]){
                                        base_path += path_array[1] + '/';
                                    }
                                    if(path_array[2]){
                                        base_path += path_array[2] + '/';
                                    }
                                    if(path_array[3]){
                                        base_path += path_array[3] + '/';
                                    }
                                    if(path_array[4]){
                                        base_path += path_array[4] + '/';
                                    }                                    
                                    var already = 0;
                                    for (let i = 0; i < base_paths.length; i++) {                                        
                                        if(base_paths[i] == base_path){
                                            already = 1;
                                        }                                             
                                    }  
                                    if(already == 0){
                                        base_paths.push(base_path);
                                    }                                  
                                }
                                for (let i = 0; i < base_paths.length; i++) { 
                                    html += '<option value="' + base_paths[i] + '">' + base_paths[i] + '</option>'; 
                                }                

                            html += '</select>';   
                            html += '</td>';
                            html += '<td width="20%" align="center">';
                            html += '<input type="text" id="select-path-override-' + i + '" value="">';
                            html += '</td>';                            
                            html += '<td width="15%" align="center">';
                            html += '<a href="#" onclick="explodeOpenAPIs(' + i + ',' + "'" + apis_json_url + "'" + '); return false;">BREAK UP</a>';
                            html += '</td>';
                            html += '</tr>';                                
                            html += '</table>';   
                            html += '<hr>';   
                            html += '<table width="100%">';
                            for (const [path, method] of Object.entries(openapi.paths)) {
                                for (const [verb, operation] of Object.entries(method)) {    

                                    if(verb.toLowerCase() == 'get' || verb.toLowerCase() == 'post' || verb.toLowerCase() == 'put' || verb.toLowerCase() == 'patch' || verb.toLowerCase() == 'delete'){
                                        
                                        var operation_summary = '';
                                        if(operation.summary){
                                            var operation_summary = operation.summary.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");
                                        }
                                        var operation_description = '';
                                        if(operation.description){
                                            var operation_description = operation.description.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");
                                        }
                                        var operation_tags = "None";
                                        if(operation.tags){
                                            operation_tags = operation.tags.join(", ");
                                        }

                                        html += '<tr>';
                                        html += '<td align="right"><strong>path:</strong></td>';
                                        html += '<td width="70%" id="path-' + i + '-' + j + '-' + path + '-' + verb + '">' + path + '</td>';
                                        html += '<td width="20%">';
                                        html += '<a href="#" onclick="parseTagsFromPath(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Parse Tags</a>';
                                        html += '</td>';
                                        html += '</tr>';
                                        html += '<tr>';
                                        html += '<td align="right"><strong>verb:</strong></td>';
                                        html += '<td width="70%"><input type="text" class="form-control" id="verb-' + i + '-' + j + '-' + path + '-' + verb + '" value="' + verb + '"></td>';
                                        html += '<td width="20%"></td>';
                                        html += '</tr>';      
                                        html += '<tr>';
                                        html += '<td align="right"><strong>summary:</strong></td>';
                                        html += '<td width="70%"><input type="text" class="form-control" id="summary-' + i + '-' + j + '-' + path + '-' + verb + '" value="' + operation_summary + '" onchange="saveOpenAPISummary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;"></td>';
                                        html += '<td width="20%">';
                                        html += '<a href="#" onclick="parseCamelCaseSummary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Parse camelCase</a><br>';
                                        html += '<a href="#" onclick="generateSummary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Generate</a>';
                                        html += '</td>';
                                        html += '</tr>'; 
                                        html += '<tr>';
                                        html += '<td align="right"><strong>description:</strong></td>';
                                        html += '<td width="70%"><input type="hidden" id="description2-' + i + '-' + j + '-' + path + '-' + verb + '"><textarea style="height: 150px;" class="form-control" id="description-' + i + '-' + j + '-' + path + '-' + verb + '" onchange="saveOpenAPIDescription(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">' + operation_description + '</textarea></td>';
                                        html += '<td width="20%">';
                                        html += '<a href="#" onclick="writeOpenAPIDescription(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">New Desc</a><br>';
                                        html += '<a href="#" onclick="rollbackOpenAPIDescription(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Roll Back</a><br>';
                                        html += '</td>';                                        
                                        html += '</tr>';  
                                        html += '<tr>';
                                        html += '<td align="right"><strong>tags:</strong></td>';
                                        html += '<td width="70%"><input type="text" class="form-control" id="tags-' + i + '-' + j + '-' + path + '-' + verb + '" value="' + operation_tags + '" onchange="saveOpenAPITags(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;"></td>';
                                        html += '<td width="20%">';
                                        html += '<a href="#" onclick="dedupeOpenAPIOperationTags(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">DeDupe</a><br>';
                                        html += '<a href="#" onclick="compareOpenAPIOperationTagsWithVocabulary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Vocabulary</a>';
                                        html += '</td>';
                                        html += '</tr>';   
                                        
                                    }                                                                                                                     
                                }
                            }
                            html += '</table>';                                

                            document.getElementById("paths-" + i + "-" + j).innerHTML = html;

                            //document.getElementById("alert").innerHTML = "";
                            }

                        });
                    })
                    .catch(function (err) {
                        if (err == 'TypeError: Failed to fetch') {
                            //document.getElementById("alert").innerHTML = err;
                        }
                    });
                }

                function loadOpenAPIOverlay(i, j, openapi_path, apis_json_url) {

                    //document.getElementById("alert").innerHTML = "Loading OpenAPI..."

                    //console.log("pulling: " + openapi_path);
                    //console.log("pulling: " + apis_json_url);

                    var url = apis_json_url.replace("overlays/apis-io-search.yml", openapi_path);
                    //var url = apis_json_url.replace("apis.md", openapi_path);
                    url = url.replace("properties/", "overlays/");
                    url = url.replace("-openapi-original.yml", "-openapi-search.yml");

                     //console.log("overlay: " + url);

                    const options = {
                        method: 'GET'
                    };

                    fetch(url, options)
                        .then(function (response) {

                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.text().then(function (yaml) {

                                //console.log(yaml);
                                yaml = yaml.replace("---","");
                                yaml = yaml.replace("---","");                                
                                var openapi = jsyaml.load(yaml);
                                //console.log(openapi);
                                document.getElementById("openapi").value = JSON.stringify(openapi);
                                //console.log(i);
                                //console.log(j);

                                if(openapi.paths){
                                
                                    html = '';

                                    html += '<table width="100%" style="background-color: #CCC;">';
                                    html += '<tr>';
                                    html += '<td align="right" width="20%"><strong>Paths:</strong></td>';
                                    html += '<td width="65%">';
                                    html += '<select id="select-path-' + i + '">';
                                        
                                    var base_paths = [];
                                    for (const [path, method] of Object.entries(openapi.paths)) {
                                        var path_array = path.split("/");
                                        //var base_path = path_array[0] + '/' + path_array[1];
                                        var base_path = path_array[0] + '/';
                                        if(path_array[1]){
                                            base_path += path_array[1] + '/';
                                         }
                                        if(path_array[2]){
                                            base_path += path_array[2] + '/';
                                        }
                                        if(path_array[3]){
                                            base_path += path_array[3];
                                        }
                                        var already = 0;
                                        for (let i = 0; i < base_paths.length; i++) {                                        
                                            if(base_paths[i] == base_path){
                                                already = 1;
                                            }                                             
                                        }  
                                        if(already == 0){
                                            base_paths.push(base_path);
                                        }                                  
                                    }
                                    for (let i = 0; i < base_paths.length; i++) { 
                                        html += '<option value="' + base_paths[i] + '">' + base_paths[i] + '</option>'; 
                                    }                

                                html += '</select>';   
                                html += '</td>';
                                html += '<td width="15%" align="center">';
                                html += '<a href="#" onclick="explodeOpenAPIs(' + i + ',' + "'" + apis_json_url + "'" + '); return false;">BREAK UP</a>';
                                html += '</td>';
                                html += '</tr>';                                
                                html += '</table>';   
                                html += '<hr>';   
                                html += '<table width="100%">';
                                for (const [path, method] of Object.entries(openapi.paths)) {
                                    for (const [verb, operation] of Object.entries(method)) {    

                                        if(verb.toLowerCase() == 'get' || verb.toLowerCase() == 'post' || verb.toLowerCase() == 'put' || verb.toLowerCase() == 'patch' || verb.toLowerCase() == 'delete'){
                                            
                                            var operation_summary = '';
                                            if(operation.summary){
                                                var operation_summary = operation.summary.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");
                                            }
                                            var operation_description = '';
                                            if(operation.description){
                                                var operation_description = operation.description.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");
                                            }
                                            var operation_tags = "None";
                                            if(operation.tags){
                                                operation_tags = operation.tags.join(", ");
                                            }

                                            html += '<tr>';
                                            html += '<td align="right"><strong>path:</strong></td>';
                                            html += '<td width="70%" id="path-' + i + '-' + j + '-' + path + '-' + verb + '">' + path + '</td>';
                                            html += '<td width="20%">';
                                            html += '<a href="#" onclick="parseTagsFromPath(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Parse Tags</a>';
                                            html += '</td>';
                                            html += '</tr>';
                                            html += '<tr>';
                                            html += '<td align="right"><strong>verb:</strong></td>';
                                            html += '<td width="70%"><input type="text" class="form-control" id="verb-' + i + '-' + j + '-' + path + '-' + verb + '" value="' + verb + '"></td>';
                                            html += '<td width="20%"></td>';
                                            html += '</tr>';      
                                            html += '<tr>';
                                            html += '<td align="right"><strong>summary:</strong></td>';
                                            html += '<td width="70%"><input type="text" class="form-control" id="summary-' + i + '-' + j + '-' + path + '-' + verb + '" value="' + operation_summary + '" onchange="saveOpenAPISummary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;"></td>';
                                            html += '<td width="20%">';
                                            html += '<a href="#" onclick="parseCamelCaseSummary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Parse camelCase</a><br>';
                                            html += '<a href="#" onclick="generateSummary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Generate</a>';
                                            html += '</td>';
                                            html += '</tr>'; 
                                            html += '<tr>';
                                            html += '<td align="right"><strong>description:</strong></td>';
                                            html += '<td width="70%"><input type="hidden" id="description2-' + i + '-' + j + '-' + path + '-' + verb + '"><textarea style="height: 150px;" class="form-control" id="description-' + i + '-' + j + '-' + path + '-' + verb + '" onchange="saveOpenAPIDescription(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">' + operation_description + '</textarea></td>';
                                            html += '<td width="20%">';
                                            html += '<a href="#" onclick="writeOpenAPIDescription(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">New Desc</a><br>';
                                            html += '<a href="#" onclick="rollbackOpenAPIDescription(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Roll Back</a><br>';
                                            html += '</td>';                                        
                                            html += '</tr>';  
                                            html += '<tr>';
                                            html += '<td align="right"><strong>tags:</strong></td>';
                                            html += '<td width="70%"><input type="text" class="form-control" id="tags-' + i + '-' + j + '-' + path + '-' + verb + '" value="' + operation_tags + '" onchange="saveOpenAPITags(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;"></td>';
                                            html += '<td width="20%">';
                                            html += '<a href="#" onclick="dedupeOpenAPIOperationTags(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">DeDupe</a><br>';
                                            html += '<a href="#" onclick="compareOpenAPIOperationTagsWithVocabulary(' + i + ',' + j + ',' + "'" + path + "'" + ',' + "'" + verb + "'" + '); return false;">Vocabulary</a>';
                                            html += '</td>';
                                            html += '</tr>';   
                                            
                                        }                                                                                                                     
                                    }
                                }
                                html += '</table>';                                

                                document.getElementById("paths-" + i + "-" + j).innerHTML = html;

                                //document.getElementById("alert").innerHTML = "";
                                }

                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });
                }

                function pullTagsFromOpenAPI(i, j, openapi_path, apis_json_url) {

                    //document.getElementById("alert").innerHTML = "Pulling Tags From OpenAPI..."
                    var openapi = JSON.parse(document.getElementById("openapi").value);

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].tags = [];
                    //console.log(apis_json_overlay);
                    for (const [path, method] of Object.entries(openapi.paths)) {
                        for (const [verb, operation] of Object.entries(method)) {
                            if(verb.toLowerCase() == 'get' || verb.toLowerCase() == 'post' || verb.toLowerCase() == 'put' || verb.toLowerCase() == 'patch' || verb.toLowerCase() == 'delete'){
                                if(operation.tags){
                                    for (let k = 0; k < operation.tags.length; k++) {
                                        var already = 0;
                                        for (let l = 0; l < apis_json_overlay.apis[i].tags.length; l++) {
                                            if(operation.tags[k] == apis_json_overlay.apis[i].tags[l]){
                                                already = 1;                                                                          
                                            } 
                                        }  
                                        if(already == 0){
                                            var this_tag = operation.tags[k];
                                            if(this_tag && this_tag.length > 0){
                                                this_tag = splitPascalCase(this_tag);                                        
                                                this_tag = this_tag.trim();
                                                apis_json_overlay.apis[i].tags.push(this_tag);  
                                            }
                                        }                                    
                                    }
                                }
                            }
                        }
                    }                                     

                    document.getElementById("tags-" + i).value = apis_json_overlay.apis[i].tags;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);                    

                    }                

                function rateOpenAPI(i, j, openapi_path, apis_json_url) {

                    var github_token = document.getElementById("github_token").value;
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    var all_rules = JSON.parse(document.getElementById("rules").value);
                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    var aws_token = document.getElementById("aws_token").value;

                    var segments = apis_json_url.split("/");
                    var node = segments[4];
                    var provider = segments[7];  
                    
                    /// TEMP
                    openapi.components = {};

                    var linting_api_url = 'https://linter-api.apis.io/linter/openapi';

                    const options = {
                        method: 'POST',
                        headers: {
                            "Accept": "application/json",
                            "X-API-KEY": aws_token                 
                        },
                        body: JSON.stringify(openapi)
                    };  

                    fetch(linting_api_url,options)
                        .then(function(response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                                return;
                            }
                            response.json().then(function(data) {   

                                var api_score = 0;
                                //console.log(data);
                                var rating = {};
                                rating.weekNumber = getDateWeek();
                                rating.rule = [];

                                for (let m = 0; m < data.length; m++) {
                                    var rule = {};
                                    rule.code = data[m].code;
                                    rule.message = data[m].message;
                                    rating.rule.push(rule);

                                    for (let r = 0; r < all_rules.length; r++) {
                                        if(all_rules[r].slug == data[m].code){
                                             //console.log(data[m].code + " == " + all_rules[r].score);
                                            api_score = api_score + all_rules[r].score;
                                        }
                                    }
                                }

                                 //console.log("overall score: " + api_score);
                                apis_json_overlay.apis[i].score = api_score;
                                document.getElementById("score-" + i).value = api_score;
                                document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);

                                //console.log(rating);
                                console.log(openapi_path);
                                var ratings_overlay_path = openapi_path.replace("openapi-original.yml","openapi-api-evangelist-ratings.yml");
                                console.log(ratings_overlay_path);
                                ratings_overlay_path = ratings_overlay_path.replace("properties/","overlays/");

                                if(apis_json_overlay.apis[i].overlays){

                                }
                                else{
                                    apis_json_overlay.apis[i].overlays = [];
                                }
                                var already = 0;
                                for (let m = 0; m < apis_json_overlay.apis[i].overlays.length; m++) {
                                    if(apis_json_overlay.apis[i].overlays[m].type == 'API Evangelist Ratings' && apis_json_overlay.apis[i].overlays[m].url == ratings_overlay_path){
                                        already = 1; 
                                    }
                                }
                                if(already == 0){
                                    var overlay = {};
                                    overlay.type = "API Evangelist Ratings";
                                    overlay.url = ratings_overlay_path;
                                    apis_json_overlay.apis[i].overlays.push(overlay);
                                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                                }

                                var github_url = 'https://api.github.com/repos/api-search/' + node + '/contents/_data/' + provider + "/" + ratings_overlay_path;
                                 //console.log("github_url: " + github_url);                    

                                const options = {
                                    method: 'get',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "Authorization": 'Bearer ' + github_token
                                    }
                                };  

                                fetch(github_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                            
                                            //console.log('Error with Status Code: ' + response.status);

                                            var c = {};
                                            c.name = "Kin Lane";
                                            c.email = "kinlane@gmail.com";

                                            var m = {};
                                            m.message = 'Creating API Evangelist Rating Overlay';
                                            m.committer = c;
                                            var save_overlay = jsyaml.dump(rating);
                                            m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                            const options = {
                                                method: 'PUT',
                                                headers: {
                                                    "Accept": "application/vnd.github+json",
                                                    "Authorization": 'Bearer ' + github_token                                 
                                                },
                                                body: JSON.stringify(m)
                                            };  

                                            fetch(github_url,options)
                                                .then(function(response) {
                                                    if (!response.ok) {
                                                         //console.log('Error with Status Code: ' + response.status);
                                                        return;
                                                    }
                                                    response.json().then(function(data) {   
                                                         //console.log(data);                                                                           
                                                    });
                                                })
                                                .catch(function(err) {
                                                     //console.log('Error: ' + err);
                                            }); 

                                            return;
                                        }
                                        response.json().then(function(data) {   

                                            var sha = data.sha;
                                        
                                            var c = {};
                                            c.name = "Kin Lane";
                                            c.email = "kinlane@gmail.com";

                                            var m = {};
                                            m.message = 'Saving API Evangelist Rating Overlay';
                                            m.committer = c;
                                            m.sha = sha;
                                            var save_overlay = jsyaml.dump(rating);
                                            m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                            const options = {
                                                method: 'PUT',
                                                headers: {
                                                    "Accept": "application/vnd.github+json",
                                                    "Authorization": 'Bearer ' + github_token                                 
                                                },
                                                body: JSON.stringify(m)
                                            };  

                                            fetch(github_url,options)
                                                .then(function(response) {
                                                    if (!response.ok) {
                                                         //console.log('Error with Status Code: ' + response.status);
                                                        return;
                                                    }
                                                    response.json().then(function(data) {   
                                                        //console.log(data);                                                                           
                                                    });
                                                })
                                                .catch(function(err) {
                                                     //console.log('Error: ' + err);
                                            }); 

                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                });                                

                            });
                        })
                        .catch(function(err) {
                             //console.log('Error: ' + err);
                    });

                }

                function saveOpenAPI(i, j, openapi_path, apis_json_url) {

                    var github_token = document.getElementById("github_token").value;
                    var openapi = JSON.parse(document.getElementById("openapi").value);
                    //console.log("pulling: " + openapi_path);
                    //console.log("pulling: " + apis_json_url);

                    var segments = apis_json_url.split("/");
                    var node = segments[4];
                    var provider = segments[7];

                    var overlay = openapi_path.replace("properties/","overlays/");
                    overlay = overlay.replace("-openapi-original.yml", "-openapi-search.yml");

                    var github_url = 'https://api.github.com/repos/api-search/' + node + '/contents/_data/' + provider + '/' + overlay;
                    //console.log("github_url: " + github_url);                    

                    const options = {
                        method: 'get',
                        headers: {
                            "Accept": "application/vnd.github+json",
                            "Authorization": 'Bearer ' + github_token
                        }
                    };  

                    fetch(github_url,options)
                        .then(function(response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                                return;
                            }
                            response.json().then(function(data) {   

                                var sha = data.sha;
                            
                                var c = {};
                                c.name = "Kin Lane";
                                c.email = "kinlane@gmail.com";

                                var m = {};
                                m.message = 'Saving OpenAPI Overlay';
                                m.committer = c;
                                m.sha = sha;
                                var save_overlay = jsyaml.dump(openapi);
                                m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                const options = {
                                    method: 'PUT',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "Authorization": 'Bearer ' + github_token                                 
                                    },
                                    body: JSON.stringify(m)
                                };  

                                fetch(github_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                             //console.log('Error with Status Code: ' + response.status);
                                            return;
                                        }
                                        response.json().then(function(data) {   
                                            //console.log(data);                                                                           
                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                }); 
                            });
                        })
                        .catch(function(err) {
                             //console.log('Error: ' + err);
                    });

                }

                function saveAPIsJSON() {

                    var github_token = document.getElementById("github_token").value;

                    var apis_json = JSON.parse(document.getElementById("apis_json").value);

                    let modified = new Date();
                    apis_json.modified = modified.toISOString().split('T')[0];
                    apis_json.specificationVersion = '{{ site.specificationVersion }}';

                    //console.log(apis_json);

                    var apis_json_url = document.getElementById("include").value;
                    apis_json_url = apis_json_url.replace("apis.md","overlays/apis-io-search.yml");

                    //console.log("pulling overlay: " + apis_json_url);   

                    var segments = apis_json_url.split("/");
                    var node = segments[4];
                    var provider = segments[7];

                    var github_url = 'https://api.github.com/repos/api-search/' + node + '/contents/_apis/' + provider + '/apis.md';
                    //console.log("github_url: " + github_url);                    

                    const options = {
                        method: 'get',
                        headers: {
                            "Accept": "application/vnd.github+json",
                            "Authorization": 'Bearer ' + github_token
                        }
                    };  

                    fetch(github_url,options)
                        .then(function(response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                                return;
                            }
                            response.json().then(function(data) {   

                                var sha = data.sha;
                            
                                var c = {};
                                c.name = "Kin Lane";
                                c.email = "kinlane@gmail.com";

                                var m = {};
                                m.message = 'Saving APIs.json';
                                m.committer = c;
                                m.sha = sha;

                                var save_overlay = jsyaml.dump(apis_json);
                                save_overlay = '---\r\n' + save_overlay + '\r\n---';
                                //console.log(save_overlay);
                                m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                const options = {
                                    method: 'PUT',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "Authorization": 'Bearer ' + github_token                                 
                                    },
                                    body: JSON.stringify(m)
                                };  

                                fetch(github_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                             //console.log('Error with Status Code: ' + response.status);
                                            return;
                                        }
                                        response.json().then(function(data) {   
                                            //console.log(data);                                                                           
                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                }); 
                            });
                        })
                        .catch(function(err) {
                             //console.log('Error: ' + err);
                    });

                    }                 

                function saveAPIsJSONOverlay() {

                    var github_token = document.getElementById("github_token").value;

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    
                    let modified = new Date();
                    apis_json_overlay.modified = modified.toISOString().split('T')[0];
                    apis_json_overlay.specificationVersion = '{{ site.specificationVersion }}';

                    //console.log(apis_json_overlay);

                    var apis_json_url = document.getElementById("include").value;
                    apis_json_url = apis_json_url.replace("apis.md","overlays/apis-io-search.yml");
                    
                    //console.log("pulling overlay: " + apis_json_url);   

                    var segments = apis_json_url.split("/");
                    var node = segments[4];
                    var provider = segments[7];

                    var github_url = 'https://api.github.com/repos/api-search/' + node + '/contents/_data/' + provider + '/overlays/apis-io-search.yml';
                    //console.log("github_url: " + github_url);                    

                    const options = {
                        method: 'get',
                        headers: {
                            "Accept": "application/vnd.github+json",
                            "Authorization": 'Bearer ' + github_token
                        }
                    };  

                    fetch(github_url,options)
                        .then(function(response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                                return;
                            }
                            response.json().then(function(data) {   

                                var sha = data.sha;
                            
                                var c = {};
                                c.name = "Kin Lane";
                                c.email = "kinlane@gmail.com";

                                var m = {};
                                m.message = 'Saving OpenAPI Overlay';
                                m.committer = c;
                                m.sha = sha;

                                var save_overlay = jsyaml.dump(apis_json_overlay);
                                //console.log(save_overlay);
                                m.content = btoa(unescape(encodeURIComponent(save_overlay)));

                                const options = {
                                    method: 'PUT',
                                    headers: {
                                        "Accept": "application/vnd.github+json",
                                        "Authorization": 'Bearer ' + github_token                                 
                                    },
                                    body: JSON.stringify(m)
                                };  

                                fetch(github_url,options)
                                    .then(function(response) {
                                        if (!response.ok) {
                                             //console.log('Error with Status Code: ' + response.status);
                                            return;
                                        }
                                        response.json().then(function(data) {   
                                            //console.log(data);                                                                           
                                        });
                                    })
                                    .catch(function(err) {
                                         //console.log('Error: ' + err);
                                }); 
                            });
                        })
                        .catch(function(err) {
                             //console.log('Error: ' + err);
                    });

                    }                

                function manageNodeOverlay() {

                    //document.getElementById("alert").innerHTML = "Parsing Overlay Node..."

                    var apis_json_url = document.getElementById("include").value;
                    //console.log("pulling overlay: " + apis_json_url);
                    apis_json_url = apis_json_url.replace("apis.md","overlays/apis-io-search.yml");
                    //console.log("pulling overlay: " + apis_json_url);
                    
                    const options = {
                        method: 'GET'
                    };

                    fetch(apis_json_url, options)
                        .then(function (response) {

                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.text().then(function (yaml) {
                                yaml = yaml.replace("---", "");
                                yaml = yaml.replace("---", "");

                                var apis_json_overlay = jsyaml.load(yaml);
                                
                                var apis_json = JSON.parse(document.getElementById("apis_json").value);

                                document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);

                                //var start = document.getElementById("include-start-count").value;
                                //var end = document.getElementById("include-end-count").value;

                                for (let i = 0; i < apis_json_overlay.apis.length; i++) {

                                    //if(i >= start && i <= end){
             
                                    document.getElementById("name-" + i).value = apis_json_overlay.apis[i].name;
                                    document.getElementById("description-" + i).value = apis_json_overlay.apis[i].description;
                                    document.getElementById("tags-" + i).value = apis_json_overlay.apis[i].tags.toString();

                                    if(apis_json_overlay.apis[i].baseURL){
                                        document.getElementById("baseURL-" + i).value = apis_json_overlay.apis[i].baseURL;
                                    }
                                    if(apis_json_overlay.apis[i].humanURL){
                                        document.getElementById("humanURL-" + i).value = apis_json_overlay.apis[i].humanURL;
                                    }

                                    var html = '';

                                    if(!apis_json_overlay.apis[i].properties){ 
                                        apis_json_overlay.apis[i].properties = apis_json.apis[i].properties; 
                                    }

                                    if(apis_json_overlay.apis[i].properties){
                                    for (let j = 0; j < apis_json_overlay.apis[i].properties.length; j++) {

                                        html += '<tr>';
                                        html += '<td width="20%"><input type="text" class="form-control" id="property-type-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyType(' + i + ',' + j + ');" value="' + apis_json_overlay.apis[i].properties[j].type + '" style="width: 100%;"></td>';
                                        html += '<td width="30%"><input type="text" class="form-control" id="property-url-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyUrl(' + i + ',' + j + ');" value="' + apis_json_overlay.apis[i].properties[j].url + '" style="width: 100%;"></td>';

                                        if (apis_json_overlay.apis[i].properties[j].type == 'OpenAPI') {                                   
                                            html += '<td width="10%" align="center"><a href="#" onclick="loadOpenAPIProperty(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Load OpenAPI</a></td>';
                                            html += '<td width="10%" align="center"><a href="#" onclick="createOpenAPIOverlay(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Create Overlay</a></td>';
                                            html += '<td width="10%" align="center"><a href="#" onclick="loadOpenAPIOverlay(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Load Overlay</a></td>';                                            
                                            html += '<td width="10%" align="center"><a href="#" onclick="processOpenAPI(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Process</a></td>';
                                            html += '<td width="10%" align="center"><a href="#" onclick="pullTagsFromOpenAPI(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Tags</a></td>';                                            
                                            html += '<td width="10%" align="center"><a href="#" onclick="saveOpenAPI(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Save</a></td>';
                                            html += '<td width="10%" align="center"><a href="#" onclick="rateOpenAPI(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Rate</a></td>';
                                            html += '<td width="10%" align="center"><a href="#" onclick="resetOpenAPI(' + i + ',' + j + ',' + "'" + apis_json_overlay.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Reset</a></td>';
                                        }
                                        else {
                                            html += '<td colspan="5"></td>';
                                            html += '<td><a href="' + apis_json_overlay.apis[i].properties[j].url + '" target="_blank">View</a></td>';
                                            html += '<td width="10%" align="center"><a href="#" onclick="harvestUrl(' + i + ',' + "'" + apis_json_url + "'" + '); return false;">Harvest</a></td>';
                                        }

                                        html += '</tr>';
                                        html += '<tr><td colspan="9" id="paths-' + i + '-' + j + '"></td></tr>';

                                        }

                                        document.getElementById("property-listing-" + i).innerHTML = html;
                                    }
                                }
                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });

                    //document.getElementById("alert").innerHTML = "";
                    }  
                    
                    function saveIncludeAPIsJSONAID(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.aid = document.getElementById("aid").value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }  

                function saveIncludeAPIsJSONScore(){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.score = document.getElementById("score").value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }                      

                function saveIncludeAPIsJSONName(){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.name = document.getElementById("name").value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }  
                    
                function saveIncludeAPIsJSONDescription(){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.description = document.getElementById("description").value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }   
                    
                function saveIncludeAPIsJSONTags(){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.tags = document.getElementById("tags").value.split(",");
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }                                         

                function saveAPIsJSONAID(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].aid = document.getElementById("aid-" + i).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }  

                function saveAPIsJSONScore(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].score = document.getElementById("score-" + i).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }                      

                function saveAPIsJSONName(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].name = document.getElementById("name-" + i).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }  
                    
                function saveAPIsJSONDescription(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].description = document.getElementById("description-" + i).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }   
                    
                function saveAPIsJSONTags(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].tags = document.getElementById("tags-" + i).value.split(",");
                    console.log(apis_json_overlay.apis[i].tags);
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }     

                function generateAID(){
                    
                    var aws_token = document.getElementById("aws_token").value;

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);

                    var aid = apis_json_overlay.aid;

                    for (let j = 0; j < apis_json_overlay.apis.length; j++) { 

                        var name = apis_json_overlay.apis[j].name;
                        var slug = slugify(name);
                        var api_aid = aid + ":" +  slug;
                        apis_json_overlay.apis[j].aid = api_aid;

                        document.getElementById("aid-" + j).value = api_aid;

                    }

                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);

                }

                function processAPIsEngine(){
                    
                    var aws_token = document.getElementById("aws_token").value;

                    var apis_json_overlay = document.getElementById("apis_json_overlay").value;

                    var harvest_url = "https://engine-api.apis.io/engine/apisjson";
                    
                    const options = {
                        method: 'PUT',
                        headers: {
                            "Accept": "application/json",
                            "X-API-KEY": aws_token                
                        }, 
                        body: apis_json_overlay
                    };

                    //console.log(options);

                    fetch(harvest_url, options)
                        .then(function (response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.json().then(function (results) {

                                console.log(results); 
                                document.getElementById("engine-process-button").style.color = 'green';

                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });

                }

                function harvestUrl(i,apis_json_url){
                    
                    var aws_token = document.getElementById("aws_token").value;

                    var human_url = document.getElementById("humanURL-" + i).value;

                    var harvest_url = "https://vpjct907o6.execute-api.us-east-1.amazonaws.com/prod?url=" + human_url;
                    
                    const options = {
                        method: 'GET',
                        headers: {
                            "Accept": "application/json",
                            "X-API-KEY": aws_token                
                        }, 
                    };

                    //console.log(options);

                    fetch(harvest_url, options)
                        .then(function (response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.json().then(function (harvest_urls) {

                                //console.log(harvest_urls);

                                var html = '<table width="100%" align="center">';
                                for (let p = 0; p < harvest_urls.length; p++) {                                     
                                    var displayUrl = harvest_urls[p];
                                    var url = new URL(displayUrl);    
                                    //console.log(displayUrl + " includes " + human_url);
                                    if(displayUrl.includes(human_url)){
                                        var urlSlug = displayUrl.replace(human_url,'');
                                        if(urlSlug.length && urlSlug.length > 1){
                                            urlSlug = capitalizeFirstLetter(urlSlug);
                                            urlSlug = urlSlug.replace("/",'');
                                            urlSlug = urlSlug.replace("/",'');
                                            html += '<tr>';
                                            html += '<td width="20%" align="center"><input type="text" class="form-control" id="new-property-type-' + i + '-' + p + '" value="' + urlSlug + '" style="width: 100%;"></td>'; 
                                            html += '<td width="40%" align="left">' + displayUrl + '</td>'; 
                                            html += '<td width="10%" align="center"><a href="' + displayUrl + '" target="_blank">View</a></td>';
                                            html += '<td width="15%" align="center"><a href="#" onclick="addNewAPIProperty(' + i + ',' + "'" + apis_json_url + "'" + ',' + "'" + displayUrl + "'" + ',' + p + '); return false;" target="_blank">Add to Properties</a></td>';
                                            html += '<td width="15%" align="center"><a href="#" onclick="addNewCommonProperty(' + i + ',' + "'" + apis_json_url + "'" + ',' + "'" + displayUrl + "'" + ',' + p + '); return false;" target="_blank">Add to Commons</a></td>';
                                            html += '</tr>';
                                        }
                                    }
                                }
                                html += '</table>';
                                document.getElementById("manage-"+i).innerHTML = html;                                

                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });

                }

                function saveAPIsJSONHumanURL(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].humanURL = document.getElementById("humanURL-" + i).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }     

                function saveAPIsJSONBaseURL(i){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].baseURL = document.getElementById("baseURL-" + i).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }  

                function saveAPIsJSONPropertyType(i,j){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].properties[j].type = document.getElementById("property-type-" + i + '-' + j).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }                      
                function saveAPIsJSONPropertyUrl(i,j){
                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    apis_json_overlay.apis[i].properties[j].url = document.getElementById("property-url-" + i + '-' + j).value;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }                      

                function addNewCommonProperty(i,apis_json_url,property_type,property_url,t){

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);

                    var p = {};
                    p.type = document.getElementById("new-property-type-" + i + "-" + t).value;
                    p.url = property_url;

                    var j = apis_json_overlay.apis[i].properties.length + 1;

                    apis_json_overlay.apis[i].properties.push(p);
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);                    

                    html = '<tr>';
                    html += '<td width="20%"><input type="text" class="form-control" id="property-type-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyType(' + i + ',' + j + ');" value="' + property_type + '" style="width: 100%;"></td>';
                    html += '<td width="30%"><input type="text" class="form-control" id="property-url-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyUrl(' + i + ',' + j + ');" value="' + property_type + '" style="width: 100%;"></td>';

                    if(property_type == 'OpenAPI') {
                        html += '<td><a href="' + property_url + '" target="_blank">View</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="loadOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Load</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="pullTagsFromOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Tags</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="saveOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Save</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="resetOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Reset</a></td>';
                    }
                    else {
                        html += '<td></td>';
                        html += '<td><a href="' + property_url + '" target="_blank">View</a></td>';
                    }

                    html += '</tr>'; 

                    document.getElementById("property-listing-" + i).innerHTML = document.getElementById("property-listing-" + i).innerHTML + html;
                    }

                function addNewAPIProperty(i,apis_json_url,property_url,t){

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);

                    var property_type = document.getElementById("new-property-type-" + i + "-" + t).value;

                    var p = {};
                    //console.log("new-property-type-" + i + "-" + t);
                    p.type = property_type;
                    p.url = property_url;

                    var j = apis_json_overlay.apis[i].properties.length + 1;

                    apis_json_overlay.apis[i].properties.push(p);
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);                    

                    html = '<tr>';
                    html += '<td width="20%"><input type="text" class="form-control" id="property-type-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyType(' + i + ',' + j + ');" value="' + property_type + '" style="width: 100%;"></td>';
                    html += '<td width="30%"><input type="text" class="form-control" id="property-url-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyUrl(' + i + ',' + j + ');" value="' + property_url + '" style="width: 100%;"></td>';

                    if(property_type == 'OpenAPI') {
                        html += '<td><a href="' + property_url + '" target="_blank">View</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="loadOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Load</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="pullTagsFromOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Tags</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="saveOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Save</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="resetOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Reset</a></td>';
                    }
                    else {
                        html += '<td></td>';
                        html += '<td><a href="' + property_url + '" target="_blank">View</a></td>';
                    }

                    html += '</tr>'; 

                    document.getElementById("property-listing-" + i).innerHTML = document.getElementById("property-listing-" + i).innerHTML + html;
                    }

                function addAPIProperty(i,apis_json_url){

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    
                    var property_type = document.getElementById("property-type-" + i).value;
                    var property_url = document.getElementById("property-url-" + i).value;

                    var property_url_array = property_url.split("?");
                    property_url = property_url_array[0];
                    property_url_array = property_url.split("#");
                    property_url = property_url_array[0];
                    
                    var p = {};
                    p.type = property_type;
                    p.url = property_url;

                    var j = apis_json_overlay.apis[i].properties.length + 1;

                    apis_json_overlay.apis[i].properties.push(p);
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);                    

                    html = '<tr>';
                    html += '<td width="20%"><input type="text" class="form-control" id="property-type-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyType(' + i + ',' + j + ');" value="' + property_type + '" style="width: 100%;"></td>';
                    html += '<td width="30%"><input type="text" class="form-control" id="property-url-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyUrl(' + i + ',' + j + ');" value="' + property_url + '" style="width: 100%;"></td>';

                    if(property_type == 'OpenAPI') {
                        html += '<td><a href="' + property_url + '" target="_blank">View</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="loadOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Load</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="pullTagsFromOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Tags</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="saveOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Save</a></td>';
                        html += '<td width="10%" align="center"><a href="#" onclick="resetOpenAPI(' + i + ',' + j + ',' + "'" + property_url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Reset</a></td>';
                    }
                    else {
                        html += '<td></td>';
                        html += '<td><a href="' + property_url + '" target="_blank">View</a></td>';
                    }

                    html += '</tr>'; 
                    
                    document.getElementById("property-listing-" + i).innerHTML = document.getElementById("property-listing-" + i).innerHTML + html;
                    document.getElementById("property-type-" + i).value = '';
                    document.getElementById("property-url-" + i).value = '';
                }

                function stripAPIsJSONDescription(i){

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    var description = document.getElementById("description-" + i).value;
                    description = description.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");
                    description = description.trim();
                    apis_json_overlay.apis[i].description = description;
                    document.getElementById("description-" + i).value = description;
                    document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                    }   
                    
                function writeAPIsJSONDescription(i) {

                    var apis_json_overlay = JSON.parse(document.getElementById("apis_json_overlay").value);
                    //document.getElementById("alert").innerHTML = "Writing description"

                    var openai_token = document.getElementById("openai_token").value;

                    var description = apis_json_overlay.apis[i].description
                    description = description.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");

                    var open_ai_url = "https://api.openai.com/v1/chat/completions";

                    var chat = {};
                    chat.model = "gpt-3.5-turbo";
                    chat.messages = [];

                    var message = {};
                    message.role = "user";
                    message.content = "Can you rewrite this description of my API? " + description;
                    chat.messages.push(message);

                    chat = JSON.stringify(chat);
                    //console.log(chat);

                    const options = {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": 'Bearer ' + openai_token
                        },
                        body: chat
                    };

                    //console.log(options);

                    fetch(open_ai_url, options)
                        .then(function (response) {
                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.json().then(function (data) {
                                //console.log(data.choices[0].message.content);
                                document.getElementById("description2-" + i).value = document.getElementById("description-" + i).value;
                                document.getElementById("description-" + i).value = data.choices[0].message.content;                                    
                                apis_json_overlay.apis[i].description = data.choices[0].message.content;
                                document.getElementById("apis_json_overlay").value = JSON.stringify(apis_json_overlay);
                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });

                    //document.getElementById("alert").innerHTML = "";
                    }       
                    
                function searchBingforAPIProperties(i){

                    var bing_token = document.getElementById("bing_token").value;
                    var name = document.getElementById("name-" + i).value;
                    var search = document.getElementById("search-" + i).value;
                    search = name + ' ' + search;
                    search = encodeURIComponent(search);

                    var search_count = "50";
                    var search_offset = "0";

                    var search_url = 'https://api.bing.microsoft.com/v7.0/search?q=' + search + '&mkt=en-US&offset=0&count=49&responseFilter=Webpages&freshness=Week&setLang=en&cc=us';
                    //console.log(search_url);

                    const options = {
                        method: 'GET',
                        headers: {
                            "Accept": "application/json",
                            "Ocp-Apim-Subscription-Key": bing_token                 
                        }
                    };  

                    fetch(search_url,options)
                    .then(function(response) {
                        if (!response.ok) {
                             //console.log('Error with Status Code: ' + response.status);
                        }
                        response.json().then(function(data) {   

                            var html = '<table width="100%" align="center">';
                            for (let j = 0; j < data.webPages.value.length; j++) { 
                                var displayUrl = data.webPages.value[j].displayUrl;
                                var url = new URL(displayUrl);
                                var hostName = url.hostname;     
                                var api_name = data.webPages.value[j].name;                                
                                html += '<tr>';
                                html += '<td>' + api_name + '</td>';
                                html += '<td>' + hostName + '</td>';
                                html += '<td width="10%" align="center"><a href="' + displayUrl + '" target="_blank">View</a></td>';
                                html += '</tr>';
                            }
                            html += '</table>';
                            document.getElementById("manage-"+i).innerHTML = html;

                        });
                        })
                        .catch(function(err) {
                             //console.log('Error: ' + err);
                    });

                    }    

                function viewOnGoogle(i){
                    var api_name = document.getElementById("name-" + i).value;
                    window.open("https://www.google.com/search?q="+api_name, "searchTab");
                }                    

                function manageInclude() {

                    //document.getElementById("alert").innerHTML = "Parsing Include..."

                    var apis_json_url = document.getElementById("include").value;
                     //console.log("pulling1: " + apis_json_url);

                    const options = {
                        method: 'GET'
                    };

                    fetch(apis_json_url, options)
                        .then(function (response) {

                            if (!response.ok) {
                                 //console.log('Error with Status Code: ' + response.status);
                            }
                            response.text().then(function (yaml) {

                                var html = '';
                                document.getElementById("manage").innerHTML = html;
                                var apis_json = jsyaml.load(yaml);

                                displayInclude(apis_json,apis_json_url);

                                //console.log(apis_json); 
                                document.getElementById("apis_json").value = JSON.stringify(apis_json);

                                // pull overlay
                                //manageNodeOverlay();

                            });
                        })
                        .catch(function (err) {
                            if (err == 'TypeError: Failed to fetch') {
                                //document.getElementById("alert").innerHTML = err;
                            }
                        });

                    //document.getElementById("alert").innerHTML = "";
                }           
                
                function displayInclude(apis_json,apis_json_url){

                    console.log("GO");

                    document.getElementById("details").innerHTML = '';
                    html = '';

                    html += '<div class="form-group">';
                    html += '<label for="name"><strong>AID</strong></label>';
                    html += '<input type="text" class="form-control" id="aid" aria-describedby="aid" onchange="saveIncludeAPIsJSONAID();" value="' + apis_json.aid + '">';
                    html += '</div>';

                    html += '<div class="form-group">';
                    html += '<label for="name"><strong>Score</strong></label>';
                    html += '<input type="text" class="form-control" id="score" aria-describedby="score" onchange="saveIncludeAPIsJSONScore();" value="' + apis_json.score + '">';
                    html += '</div>';                                    

                    html += '<div class="form-group">';
                    html += '<label for="name-"><strong>Name</strong></label>';
                    html += '<input type="text" class="form-control" id="name" aria-describedby="name" value="' + apis_json.name + '" onchange="saveIncludeAPIsJSONName();">';
                    html += '</div>';
                    html += '<div class="form-group">';
                    html += '<label for="description"><strong>Description</strong></label>';
                    html += '<input type="hidden" id="description2"><textarea rows="10" style="width: 100%: height: 400px;" class="form-control" id="description" onchange="saveIncludeAPIsJSONDescription();" aria-describedby="description">' + apis_json.description + '</textarea>';
                    html += '</div>';
                    html += '<div class="form-group">';
                    html += '<label for="tags"><strong>Tags</label>';                                    
                    html += '<textarea class="form-control" id="tags" aria-describedby="tags" style="width: 100%: height: 100px;" onchange="saveIncludeAPIsJSONTags();">' + apis_json.tags + '</textarea>';                                  
                    html += '</div>';  
                    
                    document.getElementById("details").innerHTML = html;

                    for (let i = 0; i < apis_json.apis.length; i++) {
                        
                        //if(i >= start && i <= end){
                    
                        var api_name = apis_json.apis[i].name;
                        var api_aid = apis_json.apis[i].aid;
                        var api_score = apis_json.apis[i].score;
                        var api_description = apis_json.apis[i].description;
                        if (api_description) {
                            api_description = api_description.replace(/<\/?("[^"]*"|'[^']*'|[^>])*(>|$)/g, "");
                        }
                        else {
                            api_description = "No Description";
                        }

                        var api_human_url = apis_json.apis[i].humanURL;
                        var api_base_url = apis_json.apis[i].baseURL;

                        var api_tags = apis_json.apis[i].tags;
                            
                        html = document.getElementById("manage").innerHTML;

                        html += '<div class="form-group">';
                        html += '<label for="aid-' + i + '"><strong>AID</strong></label>';
                        html += '<input type="text" class="form-control" id="aid-' + i + '" aria-describedby="aid-' + i + '" onchange="saveAPIsJSONAID(' + i + ');" value="' + api_aid + '">';
                        html += '</div>';

                        html += '<div class="form-group">';
                        html += '<label for="score-' + i + '"><strong>Score</strong></label>';
                        html += '<input type="text" class="form-control" id="score-' + i + '" aria-describedby="score-' + i + '" onchange="saveAPIsJSONScore(' + i + ');" value="' + api_score + '">';
                        html += '</div>';                                    

                        html += '<div class="form-group">';
                        html += '<label for="name-' + i + '"><strong>Name</strong></label>';
                        html += '<input type="text" class="form-control" id="name-' + i + '" onchange="saveAPIsJSONName(' + i + ');" aria-describedby="name-' + i + '" value="' + api_name + '">';
                        html += '</div>';
                        html += '<div class="form-group">';
                        html += '<label for="description-' + i + '"><strong>Description</strong> (<a href="#" onclick="stripAPIsJSONDescription(' + i + '); return false;">Strip HTML</a>) (<a href="#" onclick="writeAPIsJSONDescription(' + i + '); return false;">Write</a>)</label>';
                        html += '<input type="hidden" id="description2-' + i + '"><textarea rows="10" style="width: 100%: height: 400px;" class="form-control" onchange="saveAPIsJSONDescription(' + i + ');" id="description-' + i + '" aria-describedby="description-' + i + '">' + api_description + '</textarea>';
                        html += '</div>';
                        html += '<div class="form-group">';
                        html += '<label for="tags-' + i + '"><strong>Tags</label>';                                    
                        html += '<textarea class="form-control" onchange="saveAPIsJSONTags(' + i + ');" id="tags-' + i + '" aria-describedby="description-' + i + '" style="width: 100%: height: 100px;">' + api_tags + '</textarea>';
                        html += '<a href="#" onclick="dedupeAPIsJSONAPITags(' + i + '); return false;">DeDupe</a><br>';
                        html += '<a href="#" onclick="compareAPIsJSONAPITagsWithVocabulary(' + i + '); return false;">Vocabulary</a>';                                    
                        html += '</div>';

                        html += '<div class="form-group">';
                        html += '<label for="name-' + i + '"><strong>Human URL</strong></label>';
                        html += '<input type="text" class="form-control" id="humanURL-' + i + '" onchange="saveAPIsJSONHumanURL(' + i + ');" value="' + api_human_url + '">';
                        html += '</div>';

                        html += '<div class="form-group">';
                        html += '<label for="name-' + i + '"><strong>Base URL</strong></label>';
                        html += '<input type="text" class="form-control" id="baseURL-' + i + '" onchange="saveAPIsJSONBaseURL(' + i + ');" value="' + api_base_url + '">';
                        html += '</div>';                                    
                        html += '<div class="form-group">';
                        html += '<br><table width="100%">';
                        html += '<tr>';
                        html += '<td width="40%"><h4>Properties</h4></td>';    
                        html += '<td width="40%"><input type="text" class="form-control" id="search-' + i + '" value="" style="width: 100%;"></td>'; 
                        html += '<td width="20%"><button onclick="searchBingforAPIProperties(' + i + '); return false;" type="button" class="btn btn-dark">Search</button><a href="#" onclick="viewOnGoogle(' + i + '); return false;" target="_blank">Google</td>'; 
                        html += '</tr>';
                        html += '</table>';

                        html += '<table width="100%" id="property-listing-' + i + '">';

                        if(apis_json.apis[i].properties){
                            for (let j = 0; j < apis_json.apis[i].properties.length; j++) {

                                html += '<tr>';
                                html += '<td width="20%"><input type="text" class="form-control" id="property-type-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyType(' + i + ',' + j + ');" value="' + apis_json.apis[i].properties[j].type + '" style="width: 100%;"></td>';
                                html += '<td width="30%"><input type="text" class="form-control" id="property-url-' + i + '-' + j + '" onchange="saveAPIsJSONPropertyUrl(' + i + ',' + j + ');" value="' + apis_json.apis[i].properties[j].url + '" style="width: 100%;"></td>';

                                if (apis_json.apis[i].properties[j].type == 'OpenAPI') {
                                    html += '<td><a href="' + apis_json.apis[i].properties[j].url + '" target="_blank">View</a></td>';
                                    html += '<td width="10%" align="center"><a href="#" onclick="loadOpenAPI(' + i + ',' + j + ',' + "'" + apis_json.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Load</a></td>';
                                    html += '<td width="10%" align="center"><a href="#" onclick="pullTagsFromOpenAPI(' + i + ',' + j + ',' + "'" + apis_json.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Tags</a></td>';
                                    html += '<td width="10%" align="center"><a href="#" onclick="saveOpenAPI(' + i + ',' + j + ',' + "'" + apis_json.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Save</a></td>';
                                    html += '<td width="10%" align="center"><a href="#" onclick="resetOpenAPI(' + i + ',' + j + ',' + "'" + apis_json.apis[i].properties[j].url + "'" + ',' + "'" + apis_json_url + "'" + '); return false;">Reset</a></td>';
                                }
                                else {
                                    html += '<td></td>';
                                    html += '<td width="10%" align="center><a href="' + apis_json.apis[i].properties[j].url + '" target="_blank">View</a></td>';
                                    html += '<td width="10%" align="center"><a href="#" onclick="harvestUrl(' + i + ',' + "'" + apis_json_url + "'" + '); return false;">Harvest</a></td>';
                                }

                                html += '</tr>';
                                html += '<tr><td colspan="5" id="paths-' + i + '-' + j + '"></td></tr>';

                            }
                        }
                        html += '</table>';

                        html += '<table width="100%" id="property-add-' + i + '">';
                        html += '<tr>';
                        html += '<td width="30%"><strong>Type</strong></td>';
                        html += '<td><strong>URL</strong></td>';
                        html += '<td width="20%"></td>';                                    
                        html += '</tr>';
                        html += '<tr>';
                        html += '<td width="30%"><input type="text" class="form-control" id="property-type-' + i + '" value="" style="width: 100%;"></td>';
                        html += '<td><input type="text" class="form-control" id="property-url-' + i + '" value="" style="width: 100%;"></td>';
                        html += '<td width="20%"><button onclick="addAPIProperty(' + i + '); return false;" type="button" class="btn btn-dark">Add Property</button></td>';                                    
                        html += '</tr>';                            

                        html += '</table>';
                        html += '</div>';
                        html += '<div id="manage-' + i + '"></div>';
                        html += '<br><hr><br>';
                        
                        document.getElementById("manage").innerHTML = html;

                        //}

                    }                    
                }
            </script>
        </div>
        <div class="col-2"></div>
    </div>
</div>